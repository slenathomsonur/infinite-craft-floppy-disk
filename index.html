<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Craft | Macintosh Edition</title>
    <style>
        /* Enhanced Macintosh Color Schemes for Different Users */
        :root, .admin-theme {
            --light: #E8F4FF;
            --medium: #B8D9FF;
            --dark: #6899CC;
            --darker: #386699;
        }

        .user-theme {
            --light: #F0F0F0;
            --medium: #C0C0C0;
            --dark: #808080;
            --darker: #404040;
        }

        .guest-theme {
            --light: #FFF8E8;
            --medium: #FFE8B8;
            --dark: #CCB868;
            --darker: #997838;
        }

        .mac-black { color: #000000; }
        .mac-white { color: #FFFFFF; }
        .mac-blue { color: #0066CC; }
        .mac-red { color: #CC3333; }
        .mac-green { color: #33CC66; }
        .mac-purple { color: #9933CC; }
        .mac-orange { color: #FF9900; }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Chicago', 'Monaco', 'Courier New', monospace;
            touch-action: manipulation;
        }

        body {
            background: linear-gradient(135deg, var(--light) 0%, var(--medium) 100%);
            color: var(--mac-black);
            min-height: 100vh;
            overflow: hidden;
        }

        /* CRT Effects */
        .crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            z-index: 100;
            pointer-events: none;
        }

        .crt-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.2);
            z-index: 99;
            pointer-events: none;
        }

        /* Tab System */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark);
            border-top: 2px solid #000000;
            padding: 5px 10px;
            display: flex;
            gap: 5px;
            z-index: 1000;
            height: 40px;
            align-items: center;
        }

        .tab {
            background: var(--medium);
            border: 2px solid #000000;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            color: #000000;
            border-radius: 4px;
            user-select: none;
            min-width: 80px;
            text-align: center;
            box-shadow: 2px 2px 0 var(--darker);
            position: relative;
        }

        .tab.active {
            background: var(--mac-blue);
            color: #FFFFFF;
        }

        .tab.dragging {
            opacity: 0.7;
            transform: rotate(5deg);
        }

        .closed-tabs {
            margin-left: auto;
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .closed-tab {
            background: var(--darker);
            border: 1px solid #000000;
            padding: 4px 8px;
            font-size: 10px;
            cursor: pointer;
            color: #FFFFFF;
            border-radius: 3px;
        }

        .add-tab {
            background: var(--medium);
            border: 2px solid #000000;
            padding: 6px 10px;
            font-size: 14px;
            cursor: pointer;
            color: #000000;
            border-radius: 4px;
            margin-left: 10px;
        }

        /* Screen System */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - 40px);
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--light);
        }

        #login-screen { z-index: 200; display: flex; }
        #loading-screen { z-index: 150; display: none; flex-direction: column; }
        #game-screen { z-index: 100; display: none; }

        /* Login Screen */
        .login-container {
            background: #FFFFFF;
            border: 4px solid #000000;
            border-radius: 12px;
            padding: 40px;
            width: 500px;
            max-width: 90vw;
            box-shadow: 8px 8px 0 var(--darker);
            text-align: center;
        }

        .login-title {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 30px;
        }

        .user-accounts {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .user-account {
            background: var(--light);
            border: 3px solid #000000;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .user-account:hover {
            background: var(--medium);
            transform: translate(2px, 2px);
        }

        .user-account.selected {
            background: var(--mac-blue);
            color: #FFFFFF;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--dark);
            border: 2px solid #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
        }

        .user-info {
            flex: 1;
            text-align: left;
        }

        .user-name {
            font-weight: bold;
            font-size: 16px;
        }

        .user-type {
            font-size: 12px;
            color: var(--dark);
        }

        .selected .user-type {
            color: var(--light);
        }

        .password-prompt {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: var(--light);
            border: 2px solid #000000;
            border-radius: 4px;
        }

        .password-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #000000;
            font-family: 'Monaco', 'Courier New', monospace;
            margin: 5px 0;
        }

        .login-button {
            background: linear-gradient(to bottom, var(--light), var(--medium));
            color: #000000;
            border: 3px solid #000000;
            padding: 12px 30px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 var(--darker);
            font-weight: bold;
            margin: 10px;
        }

        .login-button:hover {
            background: linear-gradient(to bottom, var(--medium), var(--dark));
            color: #FFFFFF;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--darker);
        }

        /* Loading Screen */
        .loading-container {
            text-align: center;
            background: #FFFFFF;
            border: 4px solid #000000;
            border-radius: 12px;
            padding: 40px;
            width: 500px;
            max-width: 90vw;
            box-shadow: 8px 8px 0 var(--darker);
        }

        .loading-title {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .loading-animation {
            width: 100%;
            height: 30px;
            border: 3px solid #000000;
            background: #FFFFFF;
            margin: 20px 0;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--mac-blue), var(--mac-green));
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-status {
            font-size: 14px;
            color: var(--dark);
            margin-top: 10px;
        }

        /* Game Screen */
        .mac-computer {
            width: min(1200px, 95vw);
            height: min(700px, 80vh);
            background: var(--medium);
            border: 20px solid var(--dark);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.4), inset 0 0 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow: hidden;
        }

        .mac-screen {
            background-color: #FFFFFF;
            border: 3px solid #000000;
            border-radius: 8px;
            padding: 15px;
            height: 100%;
            overflow-y: auto;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        /* Desktop */
        .desktop {
            height: 100%;
            position: relative;
        }

        .menu-bar {
            background: linear-gradient(to bottom, var(--medium), var(--dark));
            border-bottom: 2px solid #000000;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            margin-bottom: 20px;
        }

        .desktop-icons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 25px;
            padding: 25px;
        }

        .desktop-icon {
            width: 80px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s ease;
        }

        .desktop-icon:hover {
            transform: scale(1.05);
        }

        .icon-img {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--dark), var(--darker));
            border: 2px solid #000000;
            margin: 0 auto 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border-radius: 4px;
        }

        .icon-label {
            font-size: 12px;
            font-weight: bold;
        }

        /* Windows */
        .window {
            position: absolute;
            background: var(--light);
            border: 3px solid #000000;
            box-shadow: 6px 6px 0 var(--darker);
            z-index: 10;
            display: none;
            min-width: 300px;
            min-height: 200px;
            resize: both;
            overflow: auto;
        }

        .window-header {
            background: linear-gradient(to bottom, var(--mac-blue), #0055AA);
            color: #FFFFFF;
            padding: 8px 12px;
            border-bottom: 2px solid #000000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: bold;
            cursor: move;
            user-select: none;
        }

        .window-controls {
            display: flex;
            gap: 6px;
        }

        .window-control {
            width: 14px;
            height: 14px;
            border: 1px solid #000000;
            background: var(--light);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 9px;
            color: #000000;
            cursor: pointer;
            border-radius: 2px;
        }

        .window-control:hover {
            background: var(--medium);
        }

        .window-content {
            padding: 20px;
            overflow-y: auto;
            height: calc(100% - 40px);
        }

        /* Resize Handle */
        .resize-handle {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--dark);
            cursor: nwse-resize;
            border: 1px solid #000000;
        }

        /* Game Elements */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }

        .crafting-section, .inventory-section {
            background: #FFFFFF;
            border: 2px solid #000000;
            padding: 20px;
            border-radius: 5px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .elements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 2px solid var(--dark);
            background: var(--light);
            border-radius: 4px;
        }

        .element {
            background: linear-gradient(135deg, #FFFFFF, var(--light));
            border: 2px solid var(--dark);
            border-radius: 4px;
            padding: 10px;
            text-align: center;
            cursor: grab;
            font-size: 12px;
            transition: all 0.2s ease;
            color: #000000;
            box-shadow: 2px 2px 0 var(--dark);
            user-select: none;
            font-weight: bold;
        }

        .element:hover {
            background: linear-gradient(135deg, var(--light), var(--medium));
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 var(--dark);
        }

        .element.dragging {
            opacity: 0.8;
            transform: scale(0.95);
        }

        .element.impossible {
            background: linear-gradient(135deg, var(--mac-purple), #8822AA);
            color: #FFFFFF;
            border-color: var(--mac-purple);
            animation: glow 2s infinite;
        }

        .element.rare {
            background: linear-gradient(135deg, var(--mac-orange), #CC7700);
            color: #FFFFFF;
            border-color: var(--mac-orange);
        }

        .element.epic {
            background: linear-gradient(135deg, var(--mac-green), #22AA55);
            color: #FFFFFF;
            border-color: var(--mac-green);
        }

        .element.selected {
            border: 3px solid var(--mac-blue);
            box-shadow: 0 0 10px var(--mac-blue);
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--mac-purple); }
            50% { box-shadow: 0 0 20px var(--mac-purple); }
            100% { box-shadow: 0 0 5px var(--mac-purple); }
        }

        .crafting-area {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 25px 0;
            min-height: 120px;
            background: var(--light);
            border: 3px dashed var(--dark);
            padding: 15px;
            border-radius: 8px;
        }

        .slot {
            width: 80px;
            height: 80px;
            border: 3px dashed var(--dark);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #FFFFFF;
            font-size: 12px;
            text-align: center;
            padding: 8px;
            color: var(--dark);
            transition: all 0.3s ease;
            user-select: none;
            font-weight: bold;
        }

        .slot.highlight {
            border-color: var(--mac-blue);
            background-color: var(--light);
            box-shadow: 0 0 15px var(--mac-blue);
        }

        .slot.filled {
            border-style: solid;
            background: linear-gradient(135deg, var(--light), #FFFFFF);
            border-color: var(--mac-green);
            color: #000000;
        }

        .mac-button {
            background: linear-gradient(to bottom, var(--light), var(--medium));
            color: #000000;
            border: 2px solid #000000;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            box-shadow: 3px 3px 0 var(--darker);
            font-weight: bold;
            margin: 5px;
        }

        .mac-button:hover {
            background: linear-gradient(to bottom, var(--medium), var(--dark));
            color: #FFFFFF;
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 var(--darker);
        }

        .mac-button:disabled {
            background: var(--dark);
            color: var(--darker);
            cursor: not-allowed;
            transform: none;
            box-shadow: 1px 1px 0 var(--darker);
        }

        .floppy-rack {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: var(--light);
            border: 2px solid var(--dark);
            border-radius: 6px;
        }

        .inventory-floppy {
            background: linear-gradient(135deg, var(--dark), var(--darker));
            border: 3px solid #000000;
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 3px 3px 0 var(--darker);
            height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #FFFFFF;
            font-weight: bold;
        }

        .inventory-floppy:hover {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 var(--darker);
        }

        /* Auto-save Indicator */
        .save-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--mac-green);
            color: #FFFFFF;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 11px;
            z-index: 1000;
            display: none;
        }

        /* Exit Button */
        .exit-button {
            position: fixed;
            bottom: 50px;
            right: 20px;
            background: var(--mac-red);
            color: #FFFFFF;
            border: 2px solid #000000;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            box-shadow: 3px 3px 0 var(--darker);
            font-weight: bold;
            z-index: 1000;
        }

        /* Trash Can */
        .trash-can {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 64px;
            text-align: center;
            cursor: pointer;
        }

        .trash-icon {
            width: 32px;
            height: 32px;
            background: var(--dark);
            border: 1px solid #000000;
            margin: 0 auto 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
        }

        /* Floppy Save Area */
        .floppy-save-area {
            min-height: 200px;
            border: 3px dashed var(--dark);
            padding: 20px;
            margin: 15px 0;
            background: var(--light);
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .floppy-save-area.highlight {
            border-color: var(--mac-green);
            background: var(--mac-green);
            color: #FFFFFF;
        }

        /* Element Selection for Floppy */
        .element-selection {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid var(--dark);
            padding: 10px;
            margin: 10px 0;
            background: var(--light);
            border-radius: 4px;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
        }

        /* Element Detail Popup */
        .element-detail {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--light);
            border: 4px solid #000000;
            box-shadow: 8px 8px 0 var(--darker);
            z-index: 2000;
            width: 400px;
            max-width: 90vw;
            display: none;
        }

        .floppy-disk {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--dark), var(--darker));
            border: 3px solid #000000;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #FFFFFF;
            font-size: 14px;
            text-align: center;
            margin: 20px auto;
            position: relative;
        }

        .floppy-disk::before {
            content: "";
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            height: 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 3px;
        }
    </style>
</head>
<body class="user-theme">
    <div class="crt-overlay"></div>
    <div class="crt-glow"></div>
    
    <!-- Auto-save Indicator -->
    <div class="save-indicator" id="save-indicator">Auto-saved!</div>
    
    <!-- Exit Button -->
    <button class="exit-button" id="exit-button" style="display: none;">EXIT TO LOGIN</button>

    <!-- Tab System -->
    <div class="tab-bar" id="tab-bar">
        <div class="tab active" data-tab="login" draggable="true">Login</div>
        <div class="closed-tabs" id="closed-tabs"></div>
        <div class="add-tab" onclick="createNewTab()">+</div>
    </div>

    <!-- Login Screen -->
    <div class="screen" id="login-screen">
        <div class="login-container">
            <div class="login-title">Infinite Craft</div>
            <div class="login-subtitle">Macintosh Edition</div>
            
            <div class="user-accounts">
                <div class="user-account" data-user="admin" onclick="selectUser(this)">
                    <div class="user-avatar">A</div>
                    <div class="user-info">
                        <div class="user-name">Administrator</div>
                        <div class="user-type">Full system access + All apps</div>
                    </div>
                    <div class="password-prompt" id="admin-password">
                        <input type="password" class="password-input" placeholder="Enter password: admin123" id="admin-password-input">
                        <button class="mac-button" onclick="verifyAdminPassword()">LOGIN</button>
                    </div>
                </div>
                <div class="user-account" data-user="user" onclick="selectUser(this)">
                    <div class="user-avatar">U</div>
                    <div class="user-info">
                        <div class="user-name">User</div>
                        <div class="user-type">Standard access + Basic apps</div>
                    </div>
                </div>
                <div class="user-account" data-user="guest" onclick="selectUser(this)">
                    <div class="user-avatar">G</div>
                    <div class="user-info">
                        <div class="user-name">Guest</div>
                        <div class="user-type">Limited access + Few apps</div>
                    </div>
                </div>
            </div>
            
            <button class="login-button" onclick="login()" id="login-btn">
                START SYSTEM
            </button>
        </div>
    </div>

    <!-- Loading Screen -->
    <div class="screen" id="loading-screen">
        <div class="loading-container">
            <div class="loading-title">Loading System...</div>
            <div class="loading-animation">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-status" id="loading-status">Initializing...</div>
            <button class="login-button" onclick="cancelLoad()" style="margin-top: 20px;">
                CANCEL
            </button>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="screen" id="game-screen">
        <div class="mac-computer">
            <div class="mac-screen">
                <div class="desktop">
                    <div class="menu-bar">
                        <div class="apple-menu" onclick="showSystemMenu()">🍎</div>
                        <div>File Edit View Special</div>
                        <div id="menu-time">12:00 PM</div>
                    </div>
                    
                    <div class="desktop-icons" id="desktop-icons">
                        <!-- Apps will be loaded based on user type -->
                    </div>
                    
                    <!-- Trash Can -->
                    <div class="trash-can" id="trash-can">
                        <div class="trash-icon">🗑</div>
                        <div class="icon-label">Trash</div>
                    </div>
                    
                    <!-- Windows will be created dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Element Detail Popup -->
    <div class="element-detail" id="element-detail">
        <div class="window-header">
            <div>Element Details</div>
            <div class="window-controls">
                <div class="window-control" onclick="closeElementDetail()">×</div>
            </div>
        </div>
        <div class="window-content">
            <div class="floppy-disk">
                <div id="detail-element-name">Element</div>
                <div class="floppy-label" id="detail-element-rarity">Common</div>
            </div>
            <div id="detail-element-info">
                <p><strong>Description:</strong> <span id="detail-description"></span></p>
                <p><strong>Recipe:</strong> <span id="detail-recipe"></span></p>
                <p><strong>Discovered:</strong> <span id="detail-date"></span></p>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Game State
        const gameState = {
            currentUser: null,
            currentTheme: 'user-theme',
            inventory: new Set(['Earth', 'Fire', 'Water', 'Wind']),
            craftingSlots: [null, null],
            savedFloppies: [],
            tabs: ['login'],
            closedTabs: [],
            activeTab: 'login',
            userApps: {
                admin: ['crafting', 'inventory', 'floppy', 'settings', 'performance', 'advanced'],
                user: ['crafting', 'inventory', 'floppy', 'settings', 'performance'],
                guest: ['crafting', 'inventory', 'performance']
            },
            combinations: {
                'Earth+Fire': 'Lava', 'Earth+Water': 'Mud', 'Earth+Wind': 'Dust',
                'Fire+Water': 'Steam', 'Fire+Wind': 'Smoke', 'Water+Wind': 'Wave',
                'Water+Water': 'Ocean', 'Earth+Earth': 'Mountain', 'Fire+Fire': 'Volcano',
                'Wind+Wind': 'Storm', 'Lava+Water': 'Obsidian', 'Lava+Earth': 'Magma',
                'Mud+Fire': 'Brick', 'Mud+Water': 'Swamp', 'Steam+Earth': 'Geyser',
                'Smoke+Water': 'Fog', 'Dust+Fire': 'Ash', 'Dust+Water': 'Clay',
                'Wave+Earth': 'Beach', 'Ocean+Wind': 'Tsunami', 'Obsidian+Fire': 'Glass',
                'Glass+Sand': 'Hourglass', 'Hourglass+Fire': 'Time', 'Time+Time': 'Paradox',
                'Crafting+Trash': 'Software', 'Inventory+Trash': 'Database',
                'Software+Database': 'System', 'System+User': 'Interface'
            },
            elementDescriptions: {
                'Trash': 'The ultimate element of disposal. Created when applications meet their demise in the trash can. Rarity: IMPOSSIBLE',
                'Earth': 'The solid foundation of all existence.',
                'Fire': 'The transformative power of pure energy.',
                'Water': 'The fluid essence of life itself.',
                'Wind': 'The invisible force that moves all things.'
            },
            performance: {
                fps: 60,
                memory: 45,
                cpu: 33
            }
        };

        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const gameScreen = document.getElementById('game-screen');
        const exitButton = document.getElementById('exit-button');
        const tabBar = document.getElementById('tab-bar');
        const closedTabs = document.getElementById('closed-tabs');

        // Login Functions
        let selectedUser = null;

        function selectUser(element) {
            document.querySelectorAll('.user-account').forEach(user => {
                user.classList.remove('selected');
                user.querySelector('.password-prompt').style.display = 'none';
            });
            element.classList.add('selected');
            selectedUser = element.dataset.user;
            
            // Show password prompt for admin
            if (selectedUser === 'admin') {
                element.querySelector('.password-prompt').style.display = 'block';
            }
        }

        function verifyAdminPassword() {
            const passwordInput = document.getElementById('admin-password-input');
            if (passwordInput.value === 'admin123') {
                login();
            } else {
                alert('Incorrect password! The password is "admin123"');
                passwordInput.value = '';
            }
        }

        function login() {
            if (!selectedUser) {
                alert('Please select a user account!');
                return;
            }
            
            // Skip password for non-admin users
            if (selectedUser !== 'admin') {
                proceedWithLogin();
            } else {
                // Admin password is handled in verifyAdminPassword
            }
        }

        function proceedWithLogin() {
            gameState.currentUser = selectedUser;
            gameState.currentTheme = selectedUser + '-theme';
            document.body.className = gameState.currentTheme;
            
            loginScreen.style.display = 'none';
            loadingScreen.style.display = 'flex';
            startLoading();
        }

        function startLoading() {
            const steps = [
                { text: 'Booting System...', progress: 20 },
                { text: 'Loading User Profile...', progress: 40 },
                { text: 'Initializing Applications...', progress: 60 },
                { text: 'Loading Element Database...', progress: 80 },
                { text: 'Starting Infinite Craft...', progress: 100 }
            ];
            
            let currentStep = 0;
            
            function nextStep() {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    document.getElementById('loading-status').textContent = step.text;
                    document.getElementById('loading-progress').style.width = step.progress + '%';
                    currentStep++;
                    setTimeout(nextStep, 800);
                } else {
                    loadingScreen.style.display = 'none';
                    gameScreen.style.display = 'flex';
                    exitButton.style.display = 'block';
                    initGame();
                    switchTab('game');
                }
            }
            
            nextStep();
        }

        function cancelLoad() {
            loadingScreen.style.display = 'none';
            loginScreen.style.display = 'flex';
        }

        // Tab System
        function setupTabSystem() {
            // Make tabs draggable
            tabBar.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('tab')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.dataset.tab);
                }
            });

            tabBar.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            tabBar.addEventListener('drop', (e) => {
                e.preventDefault();
                const tabName = e.dataTransfer.getData('text/plain');
                const draggedTab = document.querySelector(`.tab[data-tab="${tabName}"]`);
                
                if (draggedTab && e.target.classList.contains('tab')) {
                    const targetTab = e.target;
                    const tabs = Array.from(tabBar.querySelectorAll('.tab'));
                    const draggedIndex = tabs.indexOf(draggedTab);
                    const targetIndex = tabs.indexOf(targetTab);
                    
                    if (draggedIndex !== -1 && targetIndex !== -1) {
                        if (draggedIndex < targetIndex) {
                            targetTab.after(draggedTab);
                        } else {
                            targetTab.before(draggedTab);
                        }
                    }
                }
                
                document.querySelectorAll('.tab.dragging').forEach(tab => {
                    tab.classList.remove('dragging');
                });
            });

            tabBar.addEventListener('dragend', () => {
                document.querySelectorAll('.tab.dragging').forEach(tab => {
                    tab.classList.remove('dragging');
                });
            });

            // Handle tab clicks
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('tab')) {
                    switchTab(e.target.dataset.tab);
                } else if (e.target.classList.contains('closed-tab')) {
                    reopenTab(e.target.textContent);
                }
            });

            // Handle clicking outside tabs
            document.addEventListener('click', (e) => {
                if (!e.target.classList.contains('tab') && 
                    !e.target.classList.contains('closed-tab') &&
                    !e.target.classList.contains('add-tab')) {
                    const activeTab = document.querySelector('.tab.active');
                    if (activeTab && activeTab.dataset.tab !== 'login') {
                        closeTab(activeTab.dataset.tab);
                    }
                }
            });
        }

        function switchTab(tabName) {
            gameState.activeTab = tabName;
            
            // Update tab visuals
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Show/hide screens
            loginScreen.style.display = tabName === 'login' ? 'flex' : 'none';
            gameScreen.style.display = tabName === 'game' ? 'flex' : 'none';
            
            if (tabName === 'game') {
                updateTime();
            }
        }

        function closeTab(tabName) {
            if (tabName === 'login') return; // Don't close login tab
            
            const tabElement = document.querySelector(`.tab[data-tab="${tabName}"]`);
            if (tabElement) {
                tabElement.remove();
                gameState.closedTabs.push(tabName);
                updateClosedTabs();
                
                // Switch to login tab if no tabs left
                if (!document.querySelector('.tab.active')) {
                    switchTab('login');
                }
            }
        }

        function reopenTab(tabName) {
            const index = gameState.closedTabs.indexOf(tabName);
            if (index > -1) {
                gameState.closedTabs.splice(index, 1);
                createTab(tabName);
                switchTab(tabName);
                updateClosedTabs();
            }
        }

        function createTab(tabName) {
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.dataset.tab = tabName;
            tab.textContent = tabName.charAt(0).toUpperCase() + tabName.slice(1);
            tab.draggable = true;
            tabBar.insertBefore(tab, closedTabs);
            gameState.tabs.push(tabName);
        }

        function createNewTab() {
            const newTabName = 'tab' + (gameState.tabs.length + 1);
            createTab(newTabName);
            switchTab(newTabName);
        }

        function updateClosedTabs() {
            closedTabs.innerHTML = '';
            gameState.closedTabs.forEach(tabName => {
                const closedTab = document.createElement('div');
                closedTab.className = 'closed-tab';
                closedTab.textContent = tabName;
                closedTabs.appendChild(closedTab);
            });
        }

        // Game Functions
        function initGame() {
            loadUserApps();
            createWindows();
            updateInventory();
            updateCraftingElements();
            updateDiscoveredCount();
            updateTime();
            setupDragAndDrop();
            setupTabSystem();
            startAutoSave();
            startPerformanceMonitor();
            
            setInterval(updateTime, 60000);
        }

        function loadUserApps() {
            const desktopIcons = document.getElementById('desktop-icons');
            desktopIcons.innerHTML = '';
            
            const apps = gameState.userApps[gameState.currentUser] || [];
            const appConfig = {
                crafting: { icon: '🧪', label: 'Crafting Lab' },
                inventory: { icon: '💾', label: 'Element Vault' },
                floppy: { icon: '📁', label: 'Floppy Save' },
                settings: { icon: '⚙️', label: 'System Info' },
                performance: { icon: '📊', label: 'Performance' },
                advanced: { icon: '🔧', label: 'Advanced Tools' }
            };
            
            apps.forEach(app => {
                if (appConfig[app]) {
                    const icon = document.createElement('div');
                    icon.className = 'desktop-icon';
                    icon.onclick = () => openWindow(app);
                    icon.innerHTML = `
                        <div class="icon-img">${appConfig[app].icon}</div>
                        <div class="icon-label">${appConfig[app].label}</div>
                    `;
                    desktopIcons.appendChild(icon);
                }
            });
        }

        function createWindows() {
            const desktop = document.querySelector('.desktop');
            
            // Crafting Window
            const craftingWindow = document.createElement('div');
            craftingWindow.className = 'window';
            craftingWindow.id = 'crafting-window';
            craftingWindow.style.top = '50px';
            craftingWindow.style.left = '50px';
            craftingWindow.style.width = '800px';
            craftingWindow.style.height = '500px';
            craftingWindow.innerHTML = `
                <div class="window-header">
                    <div>Crafting Laboratory</div>
                    <div class="window-controls">
                        <div class="window-control" onclick="minimizeWindow('crafting')">-</div>
                        <div class="window-control" onclick="maximizeWindow('crafting')">□</div>
                        <div class="window-control" onclick="closeWindow('crafting')">×</div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="game-area">
                        <section class="crafting-section">
                            <h2>ELEMENT WORKBENCH</h2>
                            <div class="elements-grid" id="crafting-elements"></div>
                            <div class="crafting-area">
                                <div class="slot" id="slot1">Slot 1</div>
                                <div class="plus-sign">+</div>
                                <div class="slot" id="slot2">Slot 2</div>
                            </div>
                            <div style="text-align: center;">
                                <button class="mac-button" id="combine-btn" onclick="combineElements()" disabled>COMBINE</button>
                                <button class="mac-button" onclick="clearSlots()">CLEAR</button>
                            </div>
                            <div id="result-section" style="margin-top: 15px; padding: 10px; border: 1px solid var(--dark); text-align: center; min-height: 50px; display: flex; align-items: center; justify-content: center;">
                                <p>Drag elements to slots and click COMBINE</p>
                            </div>
                        </section>
                        <section class="inventory-section">
                            <h2>ELEMENT VAULT</h2>
                            <div class="floppy-rack" id="inventory"></div>
                            <div style="text-align: center; margin-top: 15px;">
                                <div class="discovered-count">
                                    <span id="discovered-count">0</span> ELEMENTS DISCOVERED
                                </div>
                                <button class="mac-button" onclick="resetGame()">NEW GAME</button>
                                <button class="mac-button" onclick="showHint()">HINT</button>
                            </div>
                        </section>
                    </div>
                </div>
                <div class="resize-handle"></div>
            `;
            desktop.appendChild(craftingWindow);

            // Floppy Save Window
            const floppyWindow = document.createElement('div');
            floppyWindow.className = 'window';
            floppyWindow.id = 'floppy-window';
            floppyWindow.style.top = '100px';
            floppyWindow.style.left = '100px';
            floppyWindow.style.width = '600px';
            floppyWindow.style.height = '500px';
            floppyWindow.innerHTML = `
                <div class="window-header">
                    <div>Floppy Disk Save</div>
                    <div class="window-controls">
                        <div class="window-control" onclick="minimizeWindow('floppy')">-</div>
                        <div class="window-control" onclick="maximizeWindow('floppy')">□</div>
                        <div class="window-control" onclick="closeWindow('floppy')">×</div>
                    </div>
                </div>
                <div class="window-content">
                    <h3>Save Elements to Floppy</h3>
                    <p>Choose elements to save or drag elements to the save area</p>
                    
                    <div class="element-selection" id="floppy-selection">
                        <h4>Select Elements to Save:</h4>
                        <div class="selection-grid" id="selection-grid"></div>
                    </div>
                    
                    <div style="text-align: center; margin: 15px 0;">
                        <button class="mac-button" onclick="createNewFloppyFromSelection()">CREATE FLOPPY WITH SELECTED</button>
                        <button class="mac-button" onclick="clearSelection()">CLEAR SELECTION</button>
                    </div>
                    
                    <div class="floppy-save-area" id="floppy-save-area">
                        Or drag elements here to save
                    </div>
                    
                    <div id="saved-floppies" style="margin-top: 20px;"></div>
                </div>
                <div class="resize-handle"></div>
            `;
            desktop.appendChild(floppyWindow);

            // Settings Window
            const settingsWindow = document.createElement('div');
            settingsWindow.className = 'window';
            settingsWindow.id = 'settings-window';
            settingsWindow.style.top = '150px';
            settingsWindow.style.left = '150px';
            settingsWindow.style.width = '500px';
            settingsWindow.style.height = '400px';
            settingsWindow.innerHTML = `
                <div class="window-header">
                    <div>System Information</div>
                    <div class="window-controls">
                        <div class="window-control" onclick="minimizeWindow('settings')">-</div>
                        <div class="window-control" onclick="maximizeWindow('settings')">□</div>
                        <div class="window-control" onclick="closeWindow('settings')">×</div>
                    </div>
                </div>
                <div class="window-content">
                    <h3>Macintosh System 7.5</h3>
                    <div style="background: var(--light); border: 2px solid var(--dark); padding: 15px; margin: 15px 0; font-family: 'Monaco', 'Courier New', monospace; font-size: 12px;">
                        <div>User: ${gameState.currentUser}</div>
                        <div>Processor: Motorola 68040 @ 33MHz</div>
                        <div>Memory: 8MB RAM</div>
                        <div id="performance-stats">Performance: Calculating...</div>
                        <div>Elements Discovered: <span id="settings-element-count">0</span></div>
                    </div>
                    <button class="mac-button" onclick="showPerformance()">PERFORMANCE</button>
                    <button class="mac-button" onclick="exportSave()">EXPORT SAVE</button>
                    <button class="mac-button" onclick="showCredits()">CREDITS</button>
                </div>
                <div class="resize-handle"></div>
            `;
            desktop.appendChild(settingsWindow);

            // Performance Window
            const performanceWindow = document.createElement('div');
            performanceWindow.className = 'window';
            performanceWindow.id = 'performance-window';
            performanceWindow.style.top = '200px';
            performanceWindow.style.left = '200px';
            performanceWindow.style.width = '400px';
            performanceWindow.style.height = '300px';
            performanceWindow.innerHTML = `
                <div class="window-header">
                    <div>System Performance</div>
                    <div class="window-controls">
                        <div class="window-control" onclick="minimizeWindow('performance')">-</div>
                        <div class="window-control" onclick="maximizeWindow('performance')">□</div>
                        <div class="window-control" onclick="closeWindow('performance')">×</div>
                    </div>
                </div>
                <div class="window-content">
                    <h3>Real-time Performance</h3>
                    <div style="background: var(--light); border: 2px solid var(--dark); padding: 15px; margin: 15px 0; font-family: 'Monaco', 'Courier New', monospace; font-size: 12px;">
                        <div>FPS: <span id="live-fps">60</span></div>
                        <div>Memory Usage: <span id="live-memory">45%</span></div>
                        <div>CPU Load: <span id="live-cpu">33%</span></div>
                        <div>Active Windows: <span id="live-windows">0</span></div>
                    </div>
                    <button class="mac-button" onclick="stressTest()">RUN STRESS TEST</button>
                    <button class="mac-button" onclick="optimizePerformance()">OPTIMIZE</button>
                </div>
                <div class="resize-handle"></div>
            `;
            desktop.appendChild(performanceWindow);

            // Advanced Tools Window (Admin only)
            if (gameState.currentUser === 'admin') {
                const advancedWindow = document.createElement('div');
                advancedWindow.className = 'window';
                advancedWindow.id = 'advanced-window';
                advancedWindow.style.top = '250px';
                advancedWindow.style.left = '250px';
                advancedWindow.style.width = '500px';
                advancedWindow.style.height = '400px';
                advancedWindow.innerHTML = `
                    <div class="window-header">
                        <div>Advanced Tools</div>
                        <div class="window-controls">
                            <div class="window-control" onclick="minimizeWindow('advanced')">-</div>
                            <div class="window-control" onclick="maximizeWindow('advanced')">□</div>
                            <div class="window-control" onclick="closeWindow('advanced')">×</div>
                        </div>
                    </div>
                    <div class="window-content">
                        <h3>Administrator Tools</h3>
                        <div style="background: var(--light); border: 2px solid var(--dark); padding: 15px; margin: 15px 0;">
                            <p><strong>Element Management</strong></p>
                            <button class="mac-button" onclick="unlockAllElements()">UNLOCK ALL ELEMENTS</button>
                            <button class="mac-button" onclick="addRandomElement()">ADD RANDOM ELEMENT</button>
                            <button class="mac-button" onclick="resetToStarter()">RESET TO STARTER</button>
                        </div>
                        <div style="background: var(--light); border: 2px solid var(--dark); padding: 15px; margin: 15px 0;">
                            <p><strong>System Tools</strong></p>
                            <button class="mac-button" onclick="clearAllData()">CLEAR ALL DATA</button>
                            <button class="mac-button" onclick="exportAllData()">EXPORT ALL DATA</button>
                            <button class="mac-button" onclick="systemDiagnostics()">DIAGNOSTICS</button>
                        </div>
                    </div>
                    <div class="resize-handle"></div>
                `;
                desktop.appendChild(advancedWindow);
            }

            makeWindowsDraggable();
            makeWindowsResizable();
            updateFloppySelection();
        }

        function makeWindowsDraggable() {
            document.querySelectorAll('.window').forEach(window => {
                const header = window.querySelector('.window-header');
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                
                header.onmousedown = dragMouseDown;
                
                function dragMouseDown(e) {
                    e.preventDefault();
                    // Bring window to front
                    document.querySelectorAll('.window').forEach(w => {
                        w.style.zIndex = '10';
                    });
                    window.style.zIndex = '100';
                    
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                }
                
                function elementDrag(e) {
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    window.style.top = (window.offsetTop - pos2) + "px";
                    window.style.left = (window.offsetLeft - pos1) + "px";
                }
                
                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                }
            });
        }

        function makeWindowsResizable() {
            document.querySelectorAll('.window').forEach(window => {
                const resizeHandle = window.querySelector('.resize-handle');
                if (resizeHandle) {
                    resizeHandle.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        const startX = e.clientX;
                        const startY = e.clientY;
                        const startWidth = parseInt(document.defaultView.getComputedStyle(window).width, 10);
                        const startHeight = parseInt(document.defaultView.getComputedStyle(window).height, 10);
                        
                        function doResize(e) {
                            window.style.width = (startWidth + e.clientX - startX) + 'px';
                            window.style.height = (startHeight + e.clientY - startY) + 'px';
                        }
                        
                        function stopResize() {
                            document.documentElement.removeEventListener('mousemove', doResize);
                            document.documentElement.removeEventListener('mouseup', stopResize);
                        }
                        
                        document.documentElement.addEventListener('mousemove', doResize);
                        document.documentElement.addEventListener('mouseup', stopResize);
                    });
                }
            });
        }

        // Window Management
        let openWindows = new Set();

        function openWindow(windowName) {
            const window = document.getElementById(windowName + '-window');
            if (window) {
                window.style.display = 'block';
                openWindows.add(windowName);
                // Bring to front
                document.querySelectorAll('.window').forEach(w => {
                    w.style.zIndex = '10';
                });
                window.style.zIndex = '100';
                updatePerformanceStats();
            }
        }

        function closeWindow(windowName) {
            const window = document.getElementById(windowName + '-window');
            if (window) {
                window.style.display = 'none';
                openWindows.delete(windowName);
                updatePerformanceStats();
            }
        }

        function closeAllWindows() {
            document.querySelectorAll('.window').forEach(window => {
                window.style.display = 'none';
            });
            openWindows.clear();
            updatePerformanceStats();
        }

        function minimizeWindow(windowName) {
            closeWindow(windowName);
        }

        function maximizeWindow(windowName) {
            const window = document.getElementById(windowName + '-window');
            if (window) {
                window.style.width = '80%';
                window.style.height = '80%';
                window.style.top = '10%';
                window.style.left = '10%';
            }
        }

        // Enhanced Floppy Save System with Selection
        let selectedElements = new Set();

        function updateFloppySelection() {
            const selectionGrid = document.getElementById('selection-grid');
            if (!selectionGrid) return;
            
            selectionGrid.innerHTML = '';
            
            Array.from(gameState.inventory).sort().forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'element' + (selectedElements.has(element) ? ' selected' : '');
                elementDiv.textContent = element;
                elementDiv.onclick = () => toggleElementSelection(element, elementDiv);
                selectionGrid.appendChild(elementDiv);
            });
        }

        function toggleElementSelection(element, elementDiv) {
            if (selectedElements.has(element)) {
                selectedElements.delete(element);
                elementDiv.classList.remove('selected');
            } else {
                selectedElements.add(element);
                elementDiv.classList.add('selected');
            }
        }

        function createNewFloppyFromSelection() {
            if (selectedElements.size === 0) {
                showNotification('Please select at least one element!');
                return;
            }
            
            const floppy = {
                id: Date.now(),
                elements: Array.from(selectedElements),
                name: `Save_${gameState.savedFloppies.length + 1}`,
                date: new Date().toLocaleDateString()
            };
            gameState.savedFloppies.push(floppy);
            updateSavedFloppies();
            showNotification(`Created floppy with ${selectedElements.size} elements!`);
            selectedElements.clear();
            updateFloppySelection();
        }

        function clearSelection() {
            selectedElements.clear();
            updateFloppySelection();
            showNotification('Selection cleared');
        }

        // Gameplay Functions
        function updateInventory() {
            const inventory = document.getElementById('inventory');
            if (!inventory) return;
            
            inventory.innerHTML = '';
            
            Array.from(gameState.inventory).sort().forEach(element => {
                const floppy = document.createElement('div');
                floppy.className = 'inventory-floppy' + (element === 'Trash' ? ' impossible' : '');
                floppy.textContent = element;
                floppy.draggable = true;
                floppy.addEventListener('click', () => showElementDetail(element));
                inventory.appendChild(floppy);
            });
        }

        function updateCraftingElements() {
            const elementsGrid = document.getElementById('crafting-elements');
            if (!elementsGrid) return;
            
            elementsGrid.innerHTML = '';
            
            Array.from(gameState.inventory).sort().forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'element' + (element === 'Trash' ? ' impossible' : '');
                elementDiv.textContent = element;
                elementDiv.draggable = true;
                elementsGrid.appendChild(elementDiv);
            });
        }

        function updateDiscoveredCount() {
            const count = gameState.inventory.size;
            const discoveredCount = document.getElementById('discovered-count');
            if (discoveredCount) discoveredCount.textContent = count;
            const settingsCount = document.getElementById('settings-element-count');
            if (settingsCount) settingsCount.textContent = count;
        }

        function setupDragAndDrop() {
            const slots = [document.getElementById('slot1'), document.getElementById('slot2')];
            const floppySaveArea = document.getElementById('floppy-save-area');
            const trashCan = document.getElementById('trash-can');
            
            // Element dragging
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('element') || e.target.classList.contains('inventory-floppy')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.textContent);
                }
            });
            
            document.addEventListener('dragend', (e) => {
                document.querySelectorAll('.dragging').forEach(el => {
                    el.classList.remove('dragging');
                });
            });
            
            // Slot dropping
            slots.forEach(slot => {
                if (!slot) return;
                
                slot.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    slot.classList.add('highlight');
                });
                
                slot.addEventListener('dragleave', () => {
                    slot.classList.remove('highlight');
                });
                
                slot.addEventListener('drop', (e) => {
                    e.preventDefault();
                    slot.classList.remove('highlight');
                    const elementName = e.dataTransfer.getData('text/plain');
                    
                    const slotIndex = slots.indexOf(slot);
                    if (slotIndex !== -1) {
                        gameState.craftingSlots[slotIndex] = elementName;
                        slot.textContent = elementName;
                        slot.classList.add('filled');
                        updateCombineButton();
                    }
                });
            });
            
            // Floppy save area
            if (floppySaveArea) {
                floppySaveArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    floppySaveArea.classList.add('highlight');
                });
                
                floppySaveArea.addEventListener('dragleave', () => {
                    floppySaveArea.classList.remove('highlight');
                });
                
                floppySaveArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    floppySaveArea.classList.remove('highlight');
                    const elementName = e.dataTransfer.getData('text/plain');
                    saveElementToFloppy(elementName);
                });
            }
            
            // Trash can functionality
            if (trashCan) {
                trashCan.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                
                trashCan.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const elementName = e.dataTransfer.getData('text/plain');
                    if (elementName === 'Crafting' || elementName === 'Inventory') {
                        if (!gameState.inventory.has('Trash')) {
                            gameState.inventory.add('Trash');
                            updateInventory();
                            updateCraftingElements();
                            updateDiscoveredCount();
                            showNotification('✨ Special element created: Trash! ✨');
                        }
                    }
                });
            }
        }

        function saveElementToFloppy(elementName) {
            const floppy = {
                id: Date.now(),
                elements: [elementName],
                name: `Save_${gameState.savedFloppies.length + 1}`,
                date: new Date().toLocaleDateString()
            };
            gameState.savedFloppies.push(floppy);
            updateSavedFloppies();
            showNotification(`Saved "${elementName}" to floppy disk!`);
        }

        function updateSavedFloppies() {
            const container = document.getElementById('saved-floppies');
            if (!container) return;
            
            container.innerHTML = '<h4>Saved Floppies:</h4>';
            gameState.savedFloppies.forEach(floppy => {
                const floppyDiv = document.createElement('div');
                floppyDiv.style.background = 'var(--light)';
                floppyDiv.style.border = '2px solid var(--dark)';
                floppyDiv.style.padding = '10px';
                floppyDiv.style.margin = '5px 0';
                floppyDiv.style.borderRadius = '4px';
                floppyDiv.innerHTML = `
                    <strong>${floppy.name}</strong><br>
                    Elements: ${floppy.elements.join(', ')}<br>
                    Date: ${floppy.date}
                `;
                container.appendChild(floppyDiv);
            });
        }

        // Performance System
        function startPerformanceMonitor() {
            setInterval(() => {
                // Simulate performance changes based on activity
                const baseFPS = 60;
                const baseMemory = 45;
                const baseCPU = 33;
                
                // Performance drops with more open windows and elements
                const windowPenalty = openWindows.size * 2;
                const elementPenalty = Math.floor(gameState.inventory.size / 10);
                const randomVariation = Math.random() * 10 - 5; // -5 to +5
                
                gameState.performance.fps = Math.max(30, baseFPS - windowPenalty - elementPenalty + randomVariation);
                gameState.performance.memory = Math.min(95, baseMemory + windowPenalty + elementPenalty + randomVariation);
                gameState.performance.cpu = Math.min(100, baseCPU + windowPenalty + elementPenalty + randomVariation);
                
                updatePerformanceStats();
            }, 2000);
        }

        function updatePerformanceStats() {
            const stats = document.getElementById('performance-stats');
            const liveFPS = document.getElementById('live-fps');
            const liveMemory = document.getElementById('live-memory');
            const liveCPU = document.getElementById('live-cpu');
            const liveWindows = document.getElementById('live-windows');
            
            if (stats) {
                stats.textContent = `Performance: ${Math.round(gameState.performance.fps)} FPS, ${Math.round(gameState.performance.memory)}% Memory`;
            }
            if (liveFPS) liveFPS.textContent = Math.round(gameState.performance.fps);
            if (liveMemory) liveMemory.textContent = Math.round(gameState.performance.memory) + '%';
            if (liveCPU) liveCPU.textContent = Math.round(gameState.performance.cpu) + '%';
            if (liveWindows) liveWindows.textContent = openWindows.size;
        }

        // Advanced Tools Functions (Admin only)
        function unlockAllElements() {
            if (gameState.currentUser !== 'admin') return;
            Object.values(gameState.combinations).forEach(element => {
                gameState.inventory.add(element);
            });
            updateInventory();
            updateCraftingElements();
            updateDiscoveredCount();
            updateFloppySelection();
            showNotification('All elements unlocked!');
        }

        function addRandomElement() {
            if (gameState.currentUser !== 'admin') return;
            const allElements = Object.values(gameState.combinations);
            const randomElement = allElements[Math.floor(Math.random() * allElements.length)];
            gameState.inventory.add(randomElement);
            updateInventory();
            updateCraftingElements();
            updateDiscoveredCount();
            updateFloppySelection();
            showNotification(`Added random element: ${randomElement}`);
        }

        function resetToStarter() {
            if (gameState.currentUser !== 'admin') return;
            gameState.inventory.clear();
            ['Earth', 'Fire', 'Water', 'Wind'].forEach(element => {
                gameState.inventory.add(element);
            });
            updateInventory();
            updateCraftingElements();
            updateDiscoveredCount();
            updateFloppySelection();
            showNotification('Reset to starter elements');
        }

        function clearAllData() {
            if (gameState.currentUser !== 'admin') return;
            if (confirm('Are you sure you want to clear ALL data? This cannot be undone!')) {
                gameState.inventory.clear();
                gameState.savedFloppies = [];
                localStorage.removeItem('infiniteCraftSave');
                ['Earth', 'Fire', 'Water', 'Wind'].forEach(element => {
                    gameState.inventory.add(element);
                });
                updateInventory();
                updateCraftingElements();
                updateDiscoveredCount();
                updateFloppySelection();
                updateSavedFloppies();
                showNotification('All data cleared!');
            }
        }

        function exportAllData() {
            if (gameState.currentUser !== 'admin') return;
            const exportData = {
                inventory: Array.from(gameState.inventory),
                savedFloppies: gameState.savedFloppies,
                combinations: gameState.combinations,
                timestamp: new Date().toISOString()
            };
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            // In a real app, you'd trigger a download here
            showNotification('All data exported to console (check developer tools)');
            console.log('Exported Data:', exportData);
        }

        function systemDiagnostics() {
            if (gameState.currentUser !== 'admin') return;
            const diagnostics = {
                user: gameState.currentUser,
                elements: gameState.inventory.size,
                floppies: gameState.savedFloppies.length,
                performance: gameState.performance,
                openWindows: openWindows.size,
                memory: performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1048576) + 'MB' : 'N/A'
            };
            alert('System Diagnostics:\n\n' + 
                  `User: ${diagnostics.user}\n` +
                  `Elements: ${diagnostics.elements}\n` +
                  `Floppies: ${diagnostics.floppies}\n` +
                  `FPS: ${diagnostics.performance.fps}\n` +
                  `Memory: ${diagnostics.memory}\n` +
                  `Open Windows: ${diagnostics.openWindows}`);
        }

        function stressTest() {
            // Simulate a stress test that affects performance
            gameState.performance.fps = Math.max(15, gameState.performance.fps - 20);
            gameState.performance.memory = Math.min(95, gameState.performance.memory + 20);
            gameState.performance.cpu = Math.min(100, gameState.performance.cpu + 25);
            updatePerformanceStats();
            showNotification('Stress test completed! Performance may be affected temporarily.');
            
            // Recover after 5 seconds
            setTimeout(() => {
                showNotification('System recovering from stress test...');
            }, 5000);
        }

        function optimizePerformance() {
            gameState.performance.fps = 60;
            gameState.performance.memory = 45;
            gameState.performance.cpu = 33;
            updatePerformanceStats();
            showNotification('System optimized! Performance restored.');
        }

        // [Previous functions like combineElements, clearSlots, resetGame, showHint, etc. remain the same]
        // ... (including all the previous game logic functions)

        // Auto-save System
        function startAutoSave() {
            setInterval(() => {
                const saveState = {
                    inventory: Array.from(gameState.inventory),
                    savedFloppies: gameState.savedFloppies,
                    user: gameState.currentUser,
                    theme: gameState.currentTheme
                };
                localStorage.setItem('infiniteCraftSave', JSON.stringify(saveState));
                
                const indicator = document.getElementById('save-indicator');
                indicator.style.display = 'block';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 2000);
            }, 30000);
        }

        // Load saved game on startup
        document.addEventListener('DOMContentLoaded', () => {
            const savedGame = localStorage.getItem('infiniteCraftSave');
            if (savedGame) {
                try {
                    const savedState = JSON.parse(savedGame);
                    gameState.inventory = new Set(savedState.inventory);
                    gameState.savedFloppies = savedState.savedFloppies || [];
                    if (savedState.user) {
                        selectedUser = savedState.user;
                        document.querySelector(`.user-account[data-user="${savedState.user}"]`).classList.add('selected');
                    }
                    if (savedState.theme) {
                        document.body.className = savedState.theme;
                    }
                } catch (e) {
                    console.log('Starting fresh game');
                }
            }
            
            // Create initial login tab
            createTab('login');
        });

        // [Include all the remaining previous functions...]

    </script>
</body>
</html>
